<!DOCTYPE html>
<html>
    <head>
        <title>PROACT'IF - Connexion</title>
        <meta charset="UTF-8">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <link rel="stylesheet" href="css/bootstrap.min.css" />
        <link rel="stylesheet" href="css/styles.css" />
    </head>
    <body>

      <img class="img-width-100prct" src="images/fond-login.jpeg">

        <form id="form-connexion">

          <h1>Connexion</h1>

          <div class="form-group">
            <label for="exampleInputEmail1">Adresse email</label>
            <input  id="champ-login" type="email" class="form-control" placeholder="Votre adresse mail">
            <small id="emailHelp" class="form-text text-muted">Vos informations restent confidentielles.</small>
          </div>
          <div class="form-group">
            <label for="exampleInputPassword1">Mot de passe</label>
            <input id="champ-password" type="password" class="form-control" placeholder="Mot de passe">
          </div>
          <div class="row">
            <div class="col-lg-4 col-md-4">
              <button id="bouton-connexion" class="btn btn-primary">Se connecter</button>
            </div>
            <div class="col-lg-8 col-md-8">
              <div id="message" class="invalid-feedback"></div>
            </div>
          </div>
        </form>

        <script>

            function connexion() {
                var champLogin = $('#champ-login').val();
                var champPassword = $('#champ-password').val();

                $('#message').html('Connexion en cours...');

                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'connecter',
                        mail: champLogin,
                        mdp: champPassword
                    },
                    dataType: 'json'
                }).done(function (data) {
                    console.log(data);

                    var retour = data.retourConnexion;
                    console.log(retour);

                    // si connexion ok, aller sur la page suivante :
                    if (retour.localeCompare('ok') == 0) {
                        //window.location = "maPageSuivante.html";
                    }
                    else if (retour.localeCompare('nok') == 0) {
                      $('#message').html('Echec de la connexion, votre adresse email ou mot de passe est incorrect.');
                      $('#message').css('display', 'block');
                      $('#champ-login').addClass('is-invalid');
                      $('#champ-password').addClass('is-invalid');
                    }


                });
            }

            $(document).ready(function () {
                // ajout d'un "handler" sur le clic du bouton de connexion
                $('#bouton-connexion').on('click', function (e) {
                    e.preventDefault();
                    // affichage pour debugage dans la console javascript du navigateur
                    console.log('Click sur le bouton "Se Connecter"');
                    // appel de la fonction connexion
                    connexion();
                });
            });

        </script>
    </body>
</html>
